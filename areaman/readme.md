Area Project Manager: Matlab 项目管理方案
=================

Why: 为什么要有项目管理
----------

要回答这个问题，先来看看 Matlab 能做什么，一般情况下用户会用 Matlab 来做什么，
怎么做，然后才有怎么做会更好的问题。

根据 Matlab 软件的设计初衷，我们可以把 Matlab 当作数学草稿纸来用。在命令窗口中
输入 `1+1` ，它会告诉你 `ans=2`。也可以先把一些值保存在变量中，比如先为速度 v
与时间 t 赋值后，也就可以计算位移 `s = v * t` 了。也可以绘图，比如把二次函数
`y = x^2` 表示的抛物线绘制出来年曲线趋势。然后为了重用命令，避免每次在命令窗中
手敲命令，就可以把命令代码写在 .m 文件中持久保存在硬盘中，以便后来调用。…… 此
后还可以做很多，更多，因为 Matlab 是功能丰富完整的编程语言，仿真、模拟，甚至二
次开发应用程序……

然而，高级应用都是立足于基础应用的。我认为 Matlab 的基本工作方式就是当作一种解
释型脚本语言，专门为用编程的思想与方式解决数学问题或数值计算任务提供便利与优化
。当计算任务与需求逐渐增多时，我们可能要写很多的 .m 脚本或函数文件，以及保存计
算结果的 .mat 数据文件。于是就产生了文件管理的需求。在计算机上几乎任一种操作系
统中，以目录树的方式来组织管理文件都是理所当然的。而 Matlab 的基本工作方式，也
正是与系统的目录紧密结合的。Matlab 解释器运行在当前目录下，所调用的函数、脚本
或加载的数据也都是从搜索路径 (path) 中查找。

然后，再来审视一下所谓“游戏数值”是什么样的工作，有哪些游戏内容。当然首先要纠正
可能的词汇上的望文生义。游戏数值之数值，与数学或计算科学中的数值计算之数值，是
相差甚远的概念，但是，也非毫无联系。另一方面，有人说（游戏）数值只是体验问题，
那就与所谓的模糊数学一样，深具有启发性的思想。只不过在实际项目开发中，毕竟还是
要准确有力的执行，不能只空谈体验的。此外，还有江湖传言，只要小学四年级毕业会四
则运算就能做游戏数值。诚然，电子游戏最终由计算机程序实现，计算机也只会做加减乘
除而已，当前通用的计算机不会比小学生更聪明。只不过问题在于，具有庞杂系统的游戏
，会有很多数据，如何把这些数据加减乘除起来，哪些加，哪些减，那些要乘要除的数据
又放在哪里，就未必是能轻易掌控的事情了。

所以游戏数值的实现，确实用不上太高深的数学知识，只是很琐碎细致而已。而我觉得，
Matlab 的特点很适合游戏数值工作。作为简单易学的脚本语言，它可以方便地操作数据
，加工数据。而当你真冷不丁遇到相对“高深”的数学问题时，Matlab 强大的数学算法库
可以让你事半功倍。因此，要明确一点，如果用 Matlab 做数值工作，真正用到的是它的
脚本语言特性，而非它的数学特性。游戏本质上也是个程序软件，所以最好也能用程序的
思想去思考数值的逻辑与数值的工作方式。而用 Matlab 这个语言而非其他编程语言，却
是因为它默默地为你解决了数学计算的后顾之忧，以致于你可能感觉不到数学问题的存在
。就好比游戏开发中要用一个好的游戏引擎，它会帮你解决底层的计算机图形学的渲染问
题，让开发者专注游戏系统的逻辑设计上。Matlab 主要也是这样的作用，隐藏了数学计
算的问题，让数值策划专注于设计与分析数值本身的逻辑与效用。

于是，当我们打算用 Matlab 来做数值工作时，应该抱着这样一种觉悟：把数值当作游戏
项目的一个子目录工程来开发。不用奇怪，确无夸张，理应如此，就像美术、UI也应当将
其游戏的子工程来管理开发。

那么，基本工作流程图景可能是这样了。首先，为数值工程项目建个目录，最好不要太风
骚地使用含中文或空格的路径。然后这目录下的 .m 文件与 .mat 文件以及相关的非
Matlab 文件会越来越多，就需要根据功能模块创建子目录来分装管理小文件了，或者应
该从开始就规划一下将会有哪些模块。比如，可能会有以下几个子目录模块吧：设计（
design），研究（research），计算（calculate），模拟（simulate），导出（export
）。顺便提一下，本不太想在这儿谈 Excel 的问题，其实 .xlsx 文件也就是一个压缩的
文件夹，试试 winrar 打开它，它本质上也就是管理了一个目录的 xml 。所以，使用目
录树来解决一个复杂问题，是再正常不过的取向了。Excel 在提供了初级的便利后，也同
时限制了很多自由度。而如果能用 Matlab 去做一个游戏的数值工程，你需要自动手动去
维护管理一个目录的大小文件，自由与机会并存，你可能在此基础上做更多的事。

最起码的一件事，当你的 matlab 文件下放组织到子目录后，最好把每个子目录都加到搜
索路径了，避免频繁地进入到子目录中去运行脚本，更可解决子目录间脚本的相互引用问
题。手动添加路径也非难事。不过假设有多个项目并存的话，可能要纠结注意一下同名脚
本函数的交叉污染。因此，更好的做法时，项目诸目录应该只是临时搜索路径，不要加在
Matlab 的全局搜索路径上。

而这里提供的一组脚本工具，其初衷也就是为了更方便地做这件琐事。除了维护路径了，
它也自动保存当前工作区变量，以便在下次重新打开项目时恢复工作区。也记录最近打开
的历史项目。等等一系列小工作，就是要提醒你正在用 Matlab 做一个大项目，而不再拿
它当成草稿纸涂鸭。


How: 主要工作方式与流程介绍
----------

貌似有点头重脚轻了，才开始介绍 areaman 的使用方式了。至于为什么将名字命名为
area 而不是 project，后面会提及，不过是名字，先不必介怀。

### 1. 新建项目：newar

将 Matlab cd 到一个适合目录中，在命令窗中运行库 `newar` 脚本，就表示将要把当前
目录视为一个项目来管理了。将在当前目录下生成两个文件：

* name_ar.mat 项目信息文件
* name_ws.mat 工作区数据文件

其中，name 是项目名，也就取自目录名。*_ar.mat ，保存着有着项目的基本信息，比如
项目名称与全路径名，含有 matlab 文件待要添加入搜索路径中的子目录名等。
*_wsd.mat 用于保存与恢复工作区的主要变量，只选择性地保存含有 4 个字母以上且仅
用字母命名的变量。因为短变量名一般认为是临时在命令窗敲入的测试计算变量，包含默
认变量 `ans` 也是只 3 个字母。因此打算持久保存的变量最好取长一点且有意义易识记
的变量名。

不过千万注意，*_ws.mat 并不是项目中唯一保存数据的文件，甚至也不该是保存数据的
主要文件。项目的主要数据应该按功能模块规划好，取什么名，放在哪个目录下，文件内
部的数据结构也得清楚。*_ws.mat 只是把当前载入工作区正在运算处理的那部分数据额
外保存到项目主目录下，以便下次再打开该项目时一次性把这些数据再次载入工作区继续
工作。即使不慎把 *_ar.mat 文件删除了，也不应影响项目数据的完整性；而且，如有必
要，应该可以从 Matlab 提供的历史命令记录中找到重新计算出那些数据的步骤方法。

### 2. 打开项目: openar

在命令窗中运行 `openar` 将打开当前目录下的 *_ar.mat 文件。如果当前目录下没有项
目文件，则试图从历史记录中打开最近打开的项目。

由于 Matlab 的脚本不支持参数，故而只有让 openar 自动寻找项目去打开了。也不能将
openar 脚本写成函数调用，因为管理项目须涉及主工作区，调用函数的话开辟一个函数
栈的工作区，函数运行完返回就没了。

也因此，在一个目录下请只建一个 *_ar.mat 项目文件。newar 之后，会自动调用
openar 打开项目。打开项目之前，会把原来的工作区清空，把 *_ws.mat 数据载入。此
外，在工作区额外添加一个变量 `Area_`（末尾加了一个下划线），该变量保存着
*_ar.mat 文件内的所有变量（以 struct 方式保存载入）。我们需要用这个变量来提示
Matlab 当前“运行”着一个项目，并通过查看该变量来了解项目信息，甚至也可以修改其
内域名或域值（除非已了解整个 areaman 的工作方式，否则不建议手动修改 Area_变量
）。

这也是就是为什么要取名为 `area` 的原因了，因为大写的 `Area_` 在很大情况下会默
认排在工作区变量列表的顶部。便于一目了然看到，也减少误清变量的可能。不过提一下
，Matlab 本身是有个 area 函数的，是绘一种图的，我很少用到，所以不管它了。

然后，openar 根据 Area_ 中保存的子目录信息，将它们添加到 Matlab 搜索路径了。并
将这个项目记录添加到最近打开的项目列表中。能做什么事，取决于在 Area_ 中保存了
哪些信息。

### 3. 关闭项目：closear

关闭是打开的逆操作。当要关闭一个项目去做其他事时，closear 会处理一些善后工作。
把项目内路径从搜索路径中移除，以免全局搜索路径；保存当前工作区；保存项目文件；
最后也清空工作区，安心去作其他事去。

### 4. 保存项目：savear

因为关闭项目时会自动保存，所以这个脚本并不是很必要。不过从完整性考虑，还是提供
了这么个功能。如果很在意当前工作区的内容，而此时正好写了个很牛叉的脚本，担心一
运行会让 Matlab 崩溃，那么手动保存一下也未尝不可。

### 5. 项目记录: areas

areas() 是个函数，不是运行在主工作区上的脚本。它用于查看最近打开过的项目记录。
openar 每次打开一个项目时，会调用 hisarea() 函数添加记录。记录用的数据文件名叫
`areas_ls.mat`，在与 hisarea.m 文件同路径下。

### 6. 使用注意事项

如果真要让这个 areaman 管理工具生效，还需把这个目录加入到 Matlab 的全局搜索路
径，或拷到原来的某个搜索路径下，令 Matlab 每次启动后都能利用到 areaman 的工具
。但工作时某个具体项目中的脚本函数，不具通用性，不宜加入到全局搜索路径，就用这
个 areaman 代为管理。

然后，这也主要是一种工作方式与习惯的指引。在所谓的项目主目录下生成的两个文件
*_ar.mat 与 *_ws.mat，与常规 .mat 数据文件没有任何特殊性，你可以不小心改写覆盖
其中内容使之失效。工作区的 Area_ 变量在需要 `clear all` 时也会被连同一起清理掉
，如果想恢复只要重新打开即可，由于有项目历史记录，不必回到主目录下就能重新打开
。如果没有重新打开，一个影响只是不能正常关闭项目。如果没有正常关闭项目或忘了关
闭项目，最大的坏处也不外乎有些儿“污染”全局搜索路径，而这在重启 Matlab 软件时这
些污染路径也不会继续存在。

所以，这些可能遇到的问题其实都只是无伤大雅的小事。只要在用 Matlab 处理复杂事务
时，已经把事务本身按目录良好地组织起来了，这就是项目管理的思想。而用 areaman
最大的好处是培养这种项目管理的意识，并带来些实用便利。

其他文档
--------

更多细节参考 content.md，或源代码注释。
